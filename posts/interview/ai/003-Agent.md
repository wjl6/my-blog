---
title: "003-Agent.md"
date: 2026-01-06 20:52:18
tags: []
---

## 1. difyã€æ‰£å­ã€hiagentä»–ä»¬æœ‰ä»€ä¹ˆå…±åŒç‚¹å’Œä¸åŒç‚¹ï¼Ÿ
| ç»´åº¦         | Dify                                  | æ‰£å­ï¼ˆCozeï¼‰| HiAgent                                |
|--------------|---------------------------------------|---------------------------------------|----------------------------------------|
| é¢å‘äººç¾¤     | å¼€å‘è€…                                | æ™®é€šç”¨æˆ· / è¿è¥                       | ä¼ä¸š                                   |
| æ˜¯å¦å¼€æº     | âœ… æ˜¯                                 | âŒ å¦                                 | âŒ å¦                                   |
| ç§æœ‰åŒ–éƒ¨ç½²   | âœ… å¼º                                 | âŒ å‡ ä¹æ—                              | âœ… å¿…é¡»                                 |
| ä½ä»£ç        | ä¸­                                    | å¼º                                    | å¼º                                     |
| å·¥ç¨‹å¯æ§æ€§   | â­â­â­â­                                | â­â­                                   | â­â­â­â­â­                                 |
| ä¼ä¸šæ²»ç†     | ä¸­                                    | å¼±                                    | æå¼º                                   |
| å†…å®¹ & åˆ†å‘  | å¼±                                    | æå¼º                                  | å¼±                                     |
| å…¸å‹åœºæ™¯     | AI SaaS / å†…éƒ¨ç³»ç»Ÿ                    | èŠå¤©æœºå™¨äºº / ç©æ³•                     | æ•°å­—å‘˜å·¥ / ä¼ä¸šæµç¨‹                    |


## 2. å¦‚ä½•å°†æœ¬åœ°APIæ¥å£å°è£…ä½MCPæœåŠ¡ï¼Ÿ

æ ¸å¿ƒæ˜¯è®©ä½ çš„ **API æ¥å£é€‚é… MCP åè®®è§„èŒƒï¼Œå¯¹å¤–æä¾›æ ‡å‡†åŒ–çš„ RPC è°ƒç”¨èƒ½åŠ›ã€‚**

### ä¸€ã€æ ¸å¿ƒå‰æä¸æŠ€æœ¯é€‰å‹
1. æ ¸å¿ƒæ€è·¯  
MCP æœ¬è´¨æ˜¯åŸºäº HTTP/JSON æˆ– gRPC çš„æ ‡å‡†åŒ–åè®®ï¼Œå°è£… Java æ¥å£ä¸º MCP æœåŠ¡çš„æ ¸å¿ƒæ˜¯ï¼š
- å®šä¹‰ç¬¦åˆ MCP è§„èŒƒçš„æ¥å£ï¼ˆå…¥å‚ / å‡ºå‚ã€è¯·æ±‚æ–¹æ³•ï¼‰ï¼›
- æ­å»º MCP æœåŠ¡ç«¯æ¡†æ¶ï¼Œå°†æœ¬åœ° Java æ¥å£æ˜ å°„ä¸º MCP æ¥å£ï¼›
- æš´éœ² HTTP/gRPC ç«¯å£ï¼Œè®©å¤–éƒ¨é€šè¿‡ MCP åè®®è°ƒç”¨ä½ çš„ Java æ¥å£ã€‚
2. æ¨èæŠ€æœ¯æ ˆï¼ˆé€‚é… Java ç”Ÿæ€ï¼‰  

| ç»„ä»¶         | ä½œç”¨                          | é€‰æ‹©ç†ç”±                                   |
|--------------|-------------------------------|--------------------------------------------|
| Spring Boot  | å¿«é€Ÿæ­å»º Java æœåŠ¡            | ç”Ÿæ€å®Œå–„ï¼Œæ˜“é›†æˆå„ç±»æ’ä»¶                   |
| Spring MVC   | å¤„ç† HTTP è¯·æ±‚ï¼ˆMCP åŸºç¡€ç‰ˆï¼‰| é€‚é… MCP çš„ HTTP/JSON åè®®                 |
| gRPC         | å¤„ç†é«˜æ€§èƒ½ RPCï¼ˆMCP è¿›é˜¶ç‰ˆï¼‰| ç¬¦åˆ MCP é«˜æ€§èƒ½è°ƒç”¨éœ€æ±‚                     |
| MCP SDK      | ç®€åŒ– MCP åè®®é€‚é…             | é¿å…æ‰‹åŠ¨å†™åè®®è§£æé€»è¾‘                     |

> æ³¨ï¼šç›®å‰ä¸»æµçš„ MCP å®ç°ä»¥ Python å±…å¤šï¼ŒJava ç”Ÿæ€å¯ä¼˜å…ˆåŸºäºã€ŒHTTP/JSON ç‰ˆ MCP è§„èŒƒã€å°è£…ï¼Œé™ä½å¤æ‚åº¦ã€‚

### äºŒã€åˆ†æ­¥å®ç°ï¼šå°†æœ¬åœ° Java æ¥å£å°è£…ä¸º MCP æœåŠ¡
å‡è®¾ä½ æœ‰ä¸€ä¸ªæœ¬åœ° Java æ¥å£ UserServiceï¼ŒåŠŸèƒ½æ˜¯æ ¹æ®ç”¨æˆ· ID æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œæˆ‘ä»¬ä»¥æ­¤ä¸ºä¾‹å®Œæˆå°è£…ã€‚
#### æ­¥éª¤ 1ï¼šå®šä¹‰æœ¬åœ° Java æ¥å£ï¼ˆå¾…å°è£…çš„æ ¸å¿ƒé€»è¾‘ï¼‰
å…ˆå‡†å¤‡å¥½ä½ çš„ä¸šåŠ¡æ¥å£å’Œå®ç°ç±»ï¼š
```java
// 1. å®šä¹‰ç”¨æˆ·å®ä½“
public class User {
    private Long id;
    private String name;
    private Integer age;
    // çœç•¥ getter/setter/æ„é€ æ–¹æ³•
}

// 2. æœ¬åœ°ä¸šåŠ¡æ¥å£
public interface UserService {
    // æ ¸å¿ƒæ–¹æ³•ï¼šæ ¹æ®IDæŸ¥ç”¨æˆ·
    User getUserById(Long id);
}

// 3. æ¥å£å®ç°ç±»
@Service
public class UserServiceImpl implements UserService {
    @Override
    public User getUserById(Long id) {
        // æ¨¡æ‹Ÿæœ¬åœ°ä¸šåŠ¡é€»è¾‘ï¼ˆå®é™…å¯èƒ½æ˜¯æŸ¥æ•°æ®åº“/è°ƒç”¨å…¶ä»–æœ¬åœ°æ¥å£ï¼‰
        return new User(id, "å¼ ä¸‰", 25);
    }
}
```
#### æ­¥éª¤ 2ï¼šå¼•å…¥ MCP ç›¸å…³ä¾èµ–ï¼ˆSpring Boot é¡¹ç›®ï¼‰
åœ¨ pom.xml ä¸­æ·»åŠ æ ¸å¿ƒä¾èµ–ï¼ˆä»¥ HTTP/JSON ç‰ˆ MCP ä¸ºä¾‹ï¼‰ï¼š
```xml
<dependencies>
    <!-- Spring Boot Web æ ¸å¿ƒï¼ˆå¤„ç† HTTP è¯·æ±‚ï¼‰ -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    <!-- JSON åºåˆ—åŒ–ï¼ˆé€‚é… MCP åè®®çš„ JSON æ ¼å¼ï¼‰ -->
    <dependency>
        <groupId>com.fasterxml.jackson.core</groupId>
        <artifactId>jackson-databind</artifactId>
    </dependency>
    <!-- å¯é€‰ï¼šMCP å®˜æ–¹ Java SDKï¼ˆè‹¥æœ‰ï¼Œä¼˜å…ˆç”¨ï¼‰ -->
    <!-- <dependency>
        <groupId>com.modelcontext</groupId>
        <artifactId>mcp-sdk-java</artifactId>
        <version>æœ€æ–°ç‰ˆæœ¬</version>
    </dependency> -->
</dependencies>
```

#### æ­¥éª¤ 3ï¼šå®šä¹‰ MCP åè®®é€‚é…å±‚ï¼ˆæ ¸å¿ƒï¼‰
MCP åè®®è¦æ±‚è¯·æ±‚ / å“åº”æœ‰å›ºå®šæ ¼å¼ï¼Œæˆ‘ä»¬éœ€è¦å°è£…ã€ŒMCP è¯·æ±‚å¯¹è±¡ã€ã€ŒMCP å“åº”å¯¹è±¡ã€ï¼Œå¹¶ç¼–å†™ Controller æ˜ å°„æœ¬åœ°æ¥å£ï¼š
- 3.1 å®šä¹‰ MCP æ ‡å‡†è¯·æ±‚ / å“åº”å¯¹è±¡
```java
// MCP è¯·æ±‚å¯¹è±¡ï¼ˆç¬¦åˆ MCP åè®®è§„èŒƒï¼‰
public class MCPRequest {
    // MCP åè®®å›ºå®šå­—æ®µï¼šæ–¹æ³•åï¼ˆå¯¹åº”æœ¬åœ°æ¥å£æ–¹æ³•ï¼‰
    private String method;
    // MCP åè®®å›ºå®šå­—æ®µï¼šæ–¹æ³•å…¥å‚ï¼ˆJSON æ ¼å¼ï¼‰
    private Map<String, Object> params;
    // çœç•¥ getter/setter
}

// MCP å“åº”å¯¹è±¡ï¼ˆç¬¦åˆ MCP åè®®è§„èŒƒï¼‰
public class MCPResponse<T> {
    // çŠ¶æ€ç ï¼š0=æˆåŠŸï¼Œé0=å¤±è´¥
    private Integer code;
    // æç¤ºä¿¡æ¯
    private String msg;
    // å“åº”æ•°æ®ï¼ˆæœ¬åœ°æ¥å£è¿”å›ç»“æœï¼‰
    private T data;
    // çœç•¥ getter/setter
}
```
- ç¼–å†™ MCP æœåŠ¡ç«¯ Controllerï¼ˆæ˜ å°„æœ¬åœ°æ¥å£ï¼‰
```java
@RestController
@RequestMapping("/mcp") // MCP æœåŠ¡æ ¹è·¯å¾„
public class MCPController {

    // æ³¨å…¥æœ¬åœ°ä¸šåŠ¡æ¥å£
    @Autowired
    private UserService userService;

    // MCP æ¥å£å…¥å£ï¼šæ¥æ”¶ MCP åè®®è¯·æ±‚ï¼Œè°ƒç”¨æœ¬åœ°æ¥å£
    @PostMapping("/invoke")
    public MCPResponse<?> invoke(@RequestBody MCPRequest request) {
        try {
            // 1. è§£æ MCP è¯·æ±‚ï¼šè·å–æ–¹æ³•åå’Œå…¥å‚
            String method = request.getMethod();
            Map<String, Object> params = request.getParams();

            // 2. æ ¹æ®æ–¹æ³•åè·¯ç”±åˆ°æœ¬åœ°æ¥å£
            Object result = switch (method) {
                case "getUserById" -> {
                    // è§£æå…¥å‚ï¼šè·å–ç”¨æˆ· ID
                    Long userId = Long.parseLong(params.get("id").toString());
                    // è°ƒç”¨æœ¬åœ°æ¥å£
                    yield userService.getUserById(userId);
                }
                // æ‰©å±•ï¼šæ·»åŠ å…¶ä»–æœ¬åœ°æ¥å£æ–¹æ³•çš„è·¯ç”±
                default -> throw new IllegalArgumentException("ä¸æ”¯æŒçš„ MCP æ–¹æ³•ï¼š" + method);
            };

            // 3. å°è£… MCP æˆåŠŸå“åº”
            MCPResponse<Object> response = new MCPResponse<>();
            response.setCode(0);
            response.setMsg("success");
            response.setData(result);
            return response;

        } catch (Exception e) {
            // 4. å°è£… MCP å¤±è´¥å“åº”
            MCPResponse<Object> errorResponse = new MCPResponse<>();
            errorResponse.setCode(500);
            errorResponse.setMsg("è°ƒç”¨å¤±è´¥ï¼š" + e.getMessage());
            errorResponse.setData(null);
            return errorResponse;
        }
    }
}
```
#### æ­¥éª¤ 4ï¼šé…ç½®å¹¶å¯åŠ¨ MCP æœåŠ¡

---

## 3. RAGæ–‡æœ¬å¦‚ä½•åˆ‡åˆ†ï¼Ÿ

åˆ‡åˆ†ç›´æ¥å½±å“ä¸‰ä»¶äº‹ï¼š
- å¬å›å‡†ä¸å‡†ï¼ˆå‘é‡æ£€ç´¢ï¼‰
- ä¸Šä¸‹æ–‡æ˜¯å¦å®Œæ•´ï¼ˆå›ç­”æ˜¯å¦â€œæ–­ç‰‡â€ï¼‰
- Token æˆæœ¬ & å»¶è¿Ÿ

åˆ‡å¾—ä¸å¥½ï¼Œå…¸å‹ç—‡çŠ¶æ˜¯ï¼š
- å›ç­”åƒâ€œåªçœ‹äº†åŠé¡µè¯´æ˜ä¹¦â€
- æ˜æ˜æ–‡æ¡£é‡Œæœ‰ç­”æ¡ˆï¼Œå´æ€»æ˜¯â€œç­”éæ‰€é—®â€
- æ¨¡å‹èƒ¡ç¼–ï¼ˆå› ä¸ºä¸Šä¸‹æ–‡ä¸å¤Ÿï¼‰

### æ–‡æœ¬åˆ‡åˆ†çš„ 4 ç§å¸¸è§æ–¹å¼
#### 1ï¸âƒ£ å›ºå®šé•¿åº¦åˆ‡åˆ†ï¼ˆæœ€åŸºç¡€ï¼Œä¸æ¨èå•ç‹¬ç”¨ï¼‰
åšæ³•
- æ¯ N ä¸ªå­—ç¬¦ / Token åˆ‡ä¸€æ®µ
- å¯åŠ  overlapï¼ˆé‡å ï¼‰
```text
chunk_size = 500 tokens
chunk_overlap = 50
```
ä¼˜ç‚¹
- ç®€å•ã€å¿«
- å„ç§æ¡†æ¶éƒ½æ”¯æŒï¼ˆLangChainã€LlamaIndexï¼‰

è‡´å‘½é—®é¢˜
- è¯­ä¹‰è¢«ç¡¬åˆ‡
- æ ‡é¢˜å’Œå†…å®¹åˆ†å®¶
- é—®â€œæ€ä¹ˆé…ç½® Xâ€ï¼Œè¿”å›çš„æ˜¯â€œæ³¨æ„äº‹é¡¹çš„ååŠæ®µâ€

> ğŸ‘‰ åªé€‚åˆ demoï¼Œä¸é€‚åˆç”Ÿäº§

#### 2ï¸âƒ£ æŒ‰ç»“æ„åˆ‡åˆ†ï¼ˆæ–‡æ¡£çº§å¿…ç”¨ï¼‰
é€‚åˆï¼š
- Markdown
- æŠ€æœ¯æ–‡æ¡£
- æ¥å£æ–‡æ¡£
- åšå®¢

åˆ‡åˆ†ä¾æ®
- æ ‡é¢˜ï¼ˆ# ## ###ï¼‰
- æ®µè½
- åˆ—è¡¨
- ä»£ç å—

ç¤ºä¾‹ï¼ˆMarkdownï¼‰ï¼š
```markdown
## æ•°æ®åº“é…ç½®
è¿™é‡Œæ˜¯æ•°æ®åº“é…ç½®è¯´æ˜...

### MySQL
...

### PostgreSQL
...
```
ğŸ‘‰ åˆ‡åˆ†å•ä½ï¼š

- \## æ•°æ®åº“é…ç½® ä½œä¸ºä¸€ä¸ª chunk

- \### MySQL / ### PostgreSQL å„è‡ªç‹¬ç«‹

å¥½å¤„

- è¯­ä¹‰å®Œæ•´
- éå¸¸é€‚åˆçŸ¥è¯†åº“é—®ç­”

#### 3ï¸âƒ£ è¯­ä¹‰åˆ‡åˆ†ï¼ˆæ™ºèƒ½ä½“æ¨èï¼‰
**æ ¸å¿ƒæ€æƒ³ï¼šä¸çœ‹é•¿åº¦ï¼Œçœ‹â€œè¯­ä¹‰æ˜¯å¦æ¢è¯é¢˜äº†â€**
å¸¸è§å®ç°æ–¹å¼ï¼š
- åŸºäºå¥å­
- æ»‘åŠ¨çª—å£ + embedding ç›¸ä¼¼åº¦
- Topic change detection

ç®€å•ç†è§£
- è¿ç»­å¥å­ embedding ç›¸ä¼¼åº¦ä¸‹é™ â†’ åˆ‡
- è¯­ä¹‰å‘ç”Ÿæ˜æ˜¾è½¬æŠ˜ â†’ åˆ‡

æ•ˆæœ
- ä¸€æ®µè¯åªè®²ä¸€ä»¶äº‹
- ç‰¹åˆ«é€‚åˆ FAQã€åˆ¶åº¦ã€è¯´æ˜æ–‡

#### 4ï¸âƒ£ åœºæ™¯åŒ–åˆ‡åˆ†ï¼ˆæ™ºèƒ½ä½“æ‰ä¼šç”¨ï¼‰
è¿™æ˜¯å¾ˆå¤šäººæ²¡æ„è¯†åˆ°çš„ä¸€å±‚ ğŸ‘‡
> åŒä¸€ä»½æ–‡æ¡£ï¼Œåˆ‡æ³•åº”è¯¥éšâ€œä½¿ç”¨åœºæ™¯â€å˜åŒ–

ä¸¾ä¾‹ï¼šç”¨æˆ·æ‰‹å†Œ

| åœºæ™¯       | åˆ‡åˆ†ç­–ç•¥              |
| -------- | ----------------- |
| FAQ é—®ç­”   | ä¸€é—®ä¸€ç­”ä¸€ chunk       |
| æ“ä½œæ­¥éª¤     | ä¸€ä¸ªæ­¥éª¤é“¾ä¸€ä¸ª chunk     |
| API æŸ¥è¯¢   | ä¸€ä¸ªæ¥å£ä¸€ä¸ª chunk      |
| Agent æ‰§è¡Œ | ä¸€ä¸ªâ€œå¯è¡ŒåŠ¨å•å…ƒâ€ä¸€ä¸ª chunk |

ğŸ‘‰ å¯¹æ™ºèƒ½ä½“æ¥è¯´ï¼š
> ä¸€ä¸ª chunk = ä¸€ä¸ªâ€œå¯è¢«å¼•ç”¨ / æ¨ç† / æ‰§è¡Œâ€çš„çŸ¥è¯†å•å…ƒ

### æ™ºèƒ½ä½“å¸¸ç”¨çš„â€œé»„é‡‘åˆ‡åˆ†ç­–ç•¥â€

#### âœ… æ¨èç»„åˆ
```text
1. å…ˆæŒ‰æ–‡æ¡£ç»“æ„åˆ‡ï¼ˆæ ‡é¢˜ / æ®µè½ï¼‰
2. æ¯å—é™åˆ¶åœ¨ 300~800 tokens
3. è¶…é•¿å— â†’ å†åšè¯­ä¹‰åˆ‡åˆ†
4. ä¿ç•™ 10%~20% overlap
5. ç»™æ¯ä¸ª chunk è¡¥å……å…ƒä¿¡æ¯
```

#### åœ¨ RAG / Agent ä¸­æ€ä¹ˆé€‰ chunk å¤§å°ï¼Ÿ
| åœºæ™¯         | chunk å¤§å°       |
| ---------- | -------------- |
| FAQ / åˆ¶åº¦   | 200~400 tokens |
| æŠ€æœ¯æ–‡æ¡£       | 400~800 tokens |
| API æ–‡æ¡£     | 300~600 tokens |
| Agent å·¥å…·è¯´æ˜ | ä¸€ä¸ªâ€œåŠ¨ä½œâ€ä¸€ä¸ª chunk |

âš ï¸ chunk å¤ªå¤§
- æ£€ç´¢å‘½ä¸­ç‡ä¸‹é™
- token æˆæœ¬çˆ†ç‚¸

âš ï¸ chunk å¤ªå°
- ä¿¡æ¯ç¢ç‰‡åŒ–
- æ¨¡å‹èƒ¡è¡¥ä¸Šä¸‹æ–‡

### æœ€å®¹æ˜“å¿½ç•¥çš„ 3 ä¸ªç‚¹

#### âŒ 1. ä¸ä¿ç•™æ ‡é¢˜

æ ‡é¢˜æœ¬èº«æ˜¯è¶…çº§å¼ºè¯­ä¹‰é”šç‚¹
ğŸ‘‰ å»ºè®®ï¼šæ ‡é¢˜å†…å®¹æ‹¼è¿› chunk æ­£æ–‡

#### âŒ 2. ä¸åŒºåˆ†â€œçŸ¥è¯†å—â€å’Œâ€œæ‰§è¡Œå—â€
Agent åœºæ™¯ä¸‹è¦åŒºåˆ†ï¼š
- æè¿°æ€§æ–‡æœ¬ï¼ˆè§£é‡Šï¼‰
- æ“ä½œæ€§æ–‡æœ¬ï¼ˆèƒ½æ‰§è¡Œï¼‰

è¿™ä¿©åˆ‡æ³•ä¸ä¸€æ ·ã€‚
#### âŒ 3. åªåˆ‡ä¸€æ¬¡
æ­£ç¡®æµç¨‹æ˜¯ï¼š
```text
åŸå§‹æ–‡æ¡£
  â†“
ç»“æ„åˆ‡åˆ†
  â†“
è¯­ä¹‰ç»†åˆ†
  â†“
åœºæ™¯äºŒæ¬¡åˆ‡åˆ†
```

---

## 4. ä»¥ã€Šå‡¡äººä¿®ä»™ä¼ ã€‹å°è¯´ä¸ºä¾‹ï¼Œå¦‚ä½•å®ç°æ–‡æ¡£åˆ‡åˆ†åŠå‘é‡åŒ–ï¼Ÿ

### ç›®æ ‡å®šä¹‰ï¼ˆå…ˆè¯´æ¸…æ¥šè¦å¹²å˜›ï¼‰
ç›®æ ‡æ˜¯ï¼š
> ç”¨ Milvus å­˜å‚¨ã€Šå‡¡äººä¿®ä»™ä¼ ã€‹çš„æœ€ç»ˆå‘é‡ï¼Œç”¨äº RAG é—®ç­” / äººç‰©å…³ç³»ç†è§£ / å‰§æƒ…å›æº¯

ä¸æ˜¯å…¨æ–‡æ£€ç´¢ï¼Œè€Œæ˜¯ï¼š
- â€œéŸ©ç«‹ç¬¬ä¸€æ¬¡ç­‘åŸºæ˜¯åœ¨å“ªä¸€å·ï¼Ÿâ€
- â€œå—å®«å©‰å’ŒéŸ©ç«‹çš„å…³ç³»å‘å±•è„‰ç»œâ€
- â€œè¡€è‰²è¯•ç‚¼å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿâ€

ğŸ‘‰ è¿™å†³å®šäº†åˆ‡åˆ†ç­–ç•¥
### æ€»ä½“åˆ‡åˆ†æµæ°´çº¿
```text
åŸå§‹å°è¯´æ–‡æœ¬
  â†“
ç»“æ„åˆ‡åˆ†ï¼ˆå· / ç« ï¼‰
  â†“
è¯­ä¹‰ç»†åˆ†ï¼ˆäº‹ä»¶ / æƒ…èŠ‚ï¼‰
  â†“
åœºæ™¯äºŒæ¬¡åˆ‡åˆ†ï¼ˆRAG å¯ç”¨å•å…ƒï¼‰
  â†“
Milvus å‘é‡å…¥åº“
```
#### ä¸€ã€åŸå§‹æ–‡æ¡£é˜¶æ®µï¼ˆäººå·¥ + å·¥å…·ï¼‰
ğŸ“Œ è¾“å…¥
- ã€Šå‡¡äººä¿®ä»™ä¼ ã€‹TXT / EPUB
- å…¨æ–‡çº¦ 700~800 ä¸‡å­—

ğŸ‘¤ äººå·¥è¦åšçš„äº‹ï¼ˆå¿…é¡»ï¼‰   
âœ… äººå·¥ç¡®è®¤è¿™äº›è§„åˆ™ï¼š
- ä¸€å…±å¤šå°‘å·ï¼ˆå¦‚ï¼šå‡¡äººç¯‡ã€çµç•Œç¯‡ï¼‰
- ç« èŠ‚åˆ†éš”æ ¼å¼ï¼ˆå¦‚ï¼šç¬¬XXXç« ï¼‰
- æ˜¯å¦åŒ…å«ä½œè€…æ„Ÿè¨€ã€å¹¿å‘Šã€é‡å¤ç« èŠ‚ï¼ˆè¦å‰”é™¤ï¼‰

ğŸ‘‰ è¿™ä¸€æ­¥å¿…é¡»äººå·¥
> å°è¯´ç»“æ„ä¸ç»Ÿä¸€ï¼Œé ç¨‹åºçŒœï¼Œå¿…ç¿»è½¦

ğŸ›  å·¥å…·åšçš„äº‹
- æ¸…æ´—æ–‡æœ¬
- å»å¹¿å‘Š
- ç»Ÿä¸€ç¼–ç 
- æ ‡å‡†åŒ–ç« èŠ‚æ ‡é¢˜

äº§å‡ºï¼š
```json
{
  "volume": "å‡¡äººç¯‡",
  "chapter": "ç¬¬001ç«  å±±è¾¹å°æ‘",
  "raw_text": "éŸ©ç«‹å‡ºç”Ÿåœ¨ä¸€ä¸ªæ™®é€šå†œå®¶..."
}
```

#### äºŒã€ç»“æ„åˆ‡åˆ†ï¼ˆå¼ºç»“æ„ï¼Œå·¥å…·å®Œæˆï¼‰
ğŸ¯ ç›®æ ‡  
> ä¸ç¢°è¯­ä¹‰ï¼Œåªåˆ‡â€œå¤©ç„¶è¾¹ç•Œâ€  

åˆ‡åˆ†å±‚çº§  
```markdown
ä¹¦
 â””â”€ å·
     â””â”€ ç« 
```
ğŸ›  å·¥å…·è‡ªåŠ¨å®Œæˆ
- æ­£åˆ™åŒ¹é…ï¼š
  - ç¬¬.*ç« 
  - ç¬¬.*å·
å­˜å‚¨ç¤ºä¾‹ï¼ˆå…³ç³»å‹æ•°æ®åº“ï¼‰
```text
document
  â””â”€ volume
      â””â”€ chapter
```
```text
chapter
--------
id
volume_id
chapter_title
chapter_index
content
```
ğŸ‘‰ åˆ°è¿™ä¸€æ­¥ä¸ºæ­¢ï¼š  
- è¿˜æ²¡æœ‰ä»»ä½•å‘é‡  
- ä¸è¿› Milvus

#### ä¸‰ã€è¯­ä¹‰ç»†åˆ†ï¼ˆæœ€å…³é”®çš„ä¸€æ­¥ï¼‰
ğŸ¯ ç›®æ ‡
> â€œä¸€ç« â€æ‹†æˆ è‹¥å¹²ä¸ªâ€œæƒ…èŠ‚å—â€

ä¸¾ä¸ªçœŸå®ä¾‹å­ï¼ˆéå¸¸é‡è¦ï¼‰  
åŸç« èŠ‚ï¼ˆç®€åŒ–ï¼‰
```markdown
ç¬¬45ç«  è¡€è‰²è¯•ç‚¼

1. éŸ©ç«‹è¿›å…¥ç§˜å¢ƒ
2. é‡åˆ°å…¶ä»–ä¿®å£«
3. å‘ç°çµè‰
4. é­é‡è¿½æ€
5. æˆåŠŸé€ƒè„±
```
âŒ é”™è¯¯åˆ‡æ³•ï¼ˆå¾ˆå¤šäººä¼šè¿™ä¹ˆå¹²ï¼‰
> 1000 å­—ä¸€åˆ‡

é—®é¢˜ï¼š
- ä¸€ä¸ª chunk é‡Œæ··äº† è¿›å…¥ç§˜å¢ƒ + è¢«è¿½æ€
- é—®â€œè¡€è‰²è¯•ç‚¼æœ‰ä»€ä¹ˆå±é™©â€ â†’ å›ç­”ä¸€åŠ

âœ… æ­£ç¡®è¯­ä¹‰åˆ‡åˆ†ï¼ˆäº‹ä»¶çº§ï¼‰  
è¯­ä¹‰ chunk ç¤ºä¾‹
```json
{
  "event": "è¿›å…¥è¡€è‰²è¯•ç‚¼ç§˜å¢ƒ",
  "content": "éŸ©ç«‹è¢«ä¼ é€è¿›è¡€è‰²è¯•ç‚¼..."
}

{
  "event": "é­é‡åŒé—¨ä¿®å£«",
  "content": "ä»–åœ¨ç§˜å¢ƒä¸­é‡åˆ°äº†å‡ å..."
}

{
  "event": "è¢«è¿½æ€é€ƒç”Ÿ",
  "content": "éŸ©ç«‹å› äº‰å¤ºçµè‰è¢«è¿½æ€..."
}
```
ğŸ‘¤ äººå·¥è¦åšä»€ä¹ˆï¼Ÿ   
è¿™é‡Œæ˜¯å…³é”®åˆ†æ°´å²­ ğŸ‘‡   

äººå·¥é…ç½®çš„ä¸æ˜¯â€œåˆ‡â€ï¼Œè€Œæ˜¯ï¼š   
âœ… å®šä¹‰â€œä»€ä¹ˆç®—ä¸€ä¸ªäº‹ä»¶â€
- æˆ˜æ–— = ä¸€ä¸ªäº‹ä»¶
- äººç‰©å…³ç³»å˜åŒ– = ä¸€ä¸ªäº‹ä»¶
- å‰§æƒ…è½¬æŠ˜ = ä¸€ä¸ªäº‹ä»¶

ä½ åªéœ€è¦ç»™è§„åˆ™ï¼Œä¸ç”¨ä¸€ç« ä¸€ç« åˆ‡ã€‚

ğŸ›  å·¥å…·åšä»€ä¹ˆï¼Ÿ
- å¥å­åˆ†å‰²
- embedding ç›¸ä¼¼åº¦æ»‘åŠ¨çª—å£
- è¯­ä¹‰çªå˜æ£€æµ‹ï¼ˆtopic shiftï¼‰

ğŸ‘‰ è‡ªåŠ¨åˆ¤æ–­ï¼š
> â€œè¿™é‡Œæ˜¯ä¸æ˜¯æ¢äº†ä¸€ä»¶äº‹â€

äº§å‡ºè¡¨ï¼š
```text
semantic_chunk
---------------
id
chapter_id
event_type      -- æˆ˜æ–— / ä¿®ç‚¼ / äººç‰© / å‰§æƒ…æ¨è¿›
content
token_size
```

#### å››ã€åœºæ™¯äºŒæ¬¡åˆ‡åˆ†ï¼ˆå†³å®šè¿›ä¸è¿› Milvusï¼Œæœ€å…³é”®ä¸€æ­¥ï¼‰
> è¿™ä¸€æ­¥ 100% ä¸º RAG æœåŠ¡

ğŸ¯ ä¸æ˜¯æ‰€æœ‰ semantic chunk éƒ½è¦è¿› Milvus

ä¸¾ä¾‹ï¼šå“ªäº›è¯¥è¿›ï¼Ÿ
âœ… é€‚åˆè¿› Milvusï¼š
- é‡è¦å‰§æƒ…
- äººç‰©å…³ç³»å˜åŒ–
- ä¸–ç•Œè§‚è®¾å®š
- ä¿®ç‚¼ä½“ç³»è¯´æ˜

âŒ ä¸é€‚åˆè¿›ï¼š
- æ°´æ–‡æ—¥å¸¸
- é‡å¤å¿ƒç†æå†™
- è¿‡æ¸¡æ®µ

ğŸ‘¤ äººå·¥è¦åšä»€ä¹ˆï¼Ÿ  
åªåšâ€œç­–ç•¥é…ç½®â€ï¼Œä¸ç¢°æ•°æ®   
æ¯”å¦‚ï¼š
```text
scene_rules:
  rag:
    include_event_types:
      - æˆ˜æ–—
      - ä¿®ç‚¼çªç ´
      - é‡è¦å‰§æƒ…
      - äººç‰©å…³ç³»
    max_tokens: 600
```
ğŸ‘‰ ä½ æ˜¯åœ¨å®šä¹‰ä»·å€¼æ ‡å‡†

ğŸ›  å·¥å…·è‡ªåŠ¨å®Œæˆ
- åˆå¹¶ / æ‹†åˆ† semantic chunk
- æ§åˆ¶ token å¤§å°
- è¡¥å……ä¸Šä¸‹æ–‡ï¼ˆäººç‰©åã€ç« èŠ‚åï¼‰

æœ€ç»ˆ RAG chunk ç¤ºä¾‹
```json
{
  "content": "åœ¨è¡€è‰²è¯•ç‚¼ä¸­ï¼ŒéŸ©ç«‹å› äº‰å¤ºçµè‰é­é‡è¿½æ€...",
  "metadata": {
    "book": "å‡¡äººä¿®ä»™ä¼ ",
    "volume": "å‡¡äººç¯‡",
    "chapter": "ç¬¬45ç« ",
    "characters": ["éŸ©ç«‹"],
    "event": "è¡€è‰²è¯•ç‚¼è¿½æ€"
  }
}
```

#### äº”ã€Milvus å…¥åº“ï¼ˆå·¥å…·å®Œæˆï¼‰
content å’Œ metadata ä¸­çš„æ ¸å¿ƒè¯­ä¹‰å­—æ®µæ•´åˆä¸ºä¸€æ®µå®Œæ•´æ–‡æœ¬åå†å‘é‡åŒ–
```text
å†…å®¹ï¼šåœ¨è¡€è‰²è¯•ç‚¼ä¸­ï¼ŒéŸ©ç«‹å› äº‰å¤ºçµè‰é­é‡è¿½æ€... | ä¹¦ç±ï¼šå‡¡äººä¿®ä»™ä¼  | å·ï¼šå‡¡äººç¯‡ | ç« èŠ‚ï¼šç¬¬45ç«  | äººç‰©ï¼šéŸ©ç«‹ | äº‹ä»¶ï¼šè¡€è‰²è¯•ç‚¼è¿½æ€
```
è¿™æ ·åšçš„ä¼˜åŠ¿æ˜¯ï¼š**å‘é‡ä¸­åŒæ—¶åŒ…å« â€œæƒ…èŠ‚å†…å®¹â€ å’Œ â€œå…ƒæ•°æ®ä¸Šä¸‹æ–‡â€**ï¼Œæ£€ç´¢æ—¶æ—¢å¯ä»¥æœ â€œéŸ©ç«‹ è¡€è‰²è¯•ç‚¼ è¿½æ€â€ï¼Œä¹Ÿå¯ä»¥æœ â€œå‡¡äººä¿®ä»™ä¼  ç¬¬ 45 ç«  çµè‰â€ï¼Œå¬å›ç²¾åº¦æ›´é«˜ã€‚

Collection è®¾è®¡ç¤ºä¾‹
```text
collection: fanren_rag
fields:
- id
- embedding (vector)
- content
- volume
- chapter
- characters
- event
```
ğŸ‘¤ äººå·¥è¦é…ç½®çš„åªæœ‰è¿™äº›ï¼š
- embedding æ¨¡å‹
- å‘é‡ç»´åº¦
- ç›¸ä¼¼åº¦åº¦é‡ï¼ˆcosineï¼‰

### å®Œæ•´æµç¨‹è´£ä»»åˆ’åˆ†æ€»ç»“ï¼ˆé‡ç‚¹ï¼‰

| é˜¶æ®µ   | äººå·¥åšä»€ä¹ˆ      | å·¥å…·åšä»€ä¹ˆ              |
| ---- | ---------- | ------------------ |
| åŸå§‹æ–‡æ¡£ | ç¡®è®¤ç»“æ„ã€æ¸…æ´—è§„åˆ™  | æ–‡æœ¬è§£æ               |
| ç»“æ„åˆ‡åˆ† | å®šä¹‰â€œå·/ç« â€è§„åˆ™  | æ­£åˆ™åˆ‡åˆ†               |
| è¯­ä¹‰ç»†åˆ† | å®šä¹‰â€œäº‹ä»¶â€æ ‡å‡†   | è¯­ä¹‰æ£€æµ‹               |
| åœºæ™¯åˆ‡åˆ† | å®šä¹‰â€œä»€ä¹ˆå€¼å¾—è¿›åº“â€ | chunk ç”Ÿæˆ           |
| å‘é‡å­˜å‚¨ | æ¨¡å‹/ç´¢å¼•é…ç½®    | embedding + Milvus |

---













